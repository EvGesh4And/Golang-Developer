# gRPC (—Ç–µ–æ—Ä–∏—è)

## –û —á–µ–º –±—É–¥–µ–º –≥–æ–≤–æ—Ä–∏—Ç—å

- –ü–æ—Å–º–æ—Ç—Ä–∏–º –Ω–∞ Protobuf
- –ß—Ç–æ —Ç–∞–∫–æ–µ gRPC

## –ü–ª–∞–Ω –∑–∞–Ω—è—Ç–∏—è

- –ó–Ω–∞–∫–æ–º–∏–º—Å—è —Å Protocol buffers
- –ü—Ä—è–º–∞—è –∏ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤ Protocol buffers
- –û–ø–∏—Å–∞–Ω–∏–µ API —Å –ø–æ–º–æ—â—å—é Protobuf
- –ß—Ç–æ —Ç–∞–∫–æ–µ gRPC –∏ HTTP/2

## Protobuf

```proto
syntax = "proto3";              // –£–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è proto3

message SearchRequest {
  string query = 1;             // –¢–µ–∫—Å—Ç –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
  int32 page_number = 2;        // –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏)
  int32 results_per_page = 3;   // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
}
```

**–ö—Ä–∞—Ç–∫–∏–µ –ø–æ—è—Å–Ω–µ–Ω–∏—è:**

- `message SearchRequest` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–º–µ–Ω–µ–º `SearchRequest`.

- `string` –∏ `int32` ‚Äî —Ç–∏–ø—ã –ø–æ–ª–µ–π (—Å—Ç—Ä–æ–∫–∞ –∏ 32-–±–∏—Ç–Ω–æ–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ).

- `= 1`, `= 2`, `= 3` ‚Äî —Ç–µ–≥–∏ –ø–æ–ª–µ–π. –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—Ö–µ–º—ã, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

–≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–∏—Å–∫ –≤ API, –≥–¥–µ –∫–ª–∏–µ–Ω—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–∏—Å–∫–æ–≤—É—é —Å—Ç—Ä–æ–∫—É –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.


### Protobuf: tags

- –ù–æ–º–µ—Ä–∞ —Ç–µ–≥–æ–≤ —É–Ω–∏–∫–∞–ª—å–Ω—ã –≤ —Ä–∞–º–∫–∞—Ö —Å–æ–æ–±—â–µ–Ω–∏—è
- –ù–æ–º–µ—Ä–∞ –æ—Ç 1 –¥–æ 536.870.911
- –ù–æ–º–µ—Ä–∞ –æ—Ç 19.000 –¥–æ 19.999 –∑–∞—Ä–∞–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º
- –¢–µ–≥–∏ —Å 1 –¥–æ 15 –∑–∞–Ω–∏–º–∞—é—Ç 1 –±–∞–π—Ç


–í **protobuf** **—Ç–µ–≥–∏** (–ø–æ—Ä—è–¥–∫–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞ –ø–æ–ª–µ–π) **–≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 1, –∞ –Ω–µ —Å 0**.

–í–æ—Ç –ø–æ—á–µ–º—É:

**üî¢ –ü–æ—á–µ–º—É —Ç–µ–≥–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 1**

- **–¢–µ–≥ 0 –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω** –≤–Ω—É—Ç—Ä–∏ Protocol Buffers –∏ **–Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ–ª–µ–π.

- –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º: —Ç–µ–≥ 0 –≤ wire format –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ "–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –ø–æ–ª–µ" –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ.

- –ü–æ—ç—Ç–æ–º—É **–≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ–º —Å 1 –∏ –¥–∞–ª–µ–µ: 1, 2, 3, ...** ‚Äî –∏ –ø—Ä–∏ —ç—Ç–æ–º –≤–∞–∂–Ω–æ –Ω–µ –º–µ–Ω—è—Ç—å –∏—Ö –ø–æ—Å–ª–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å—Ö–µ–º—ã.

**üõ† –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

- **–ö–∞–∂–¥–æ–µ –ø–æ–ª–µ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–µ–≥** –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ message.
- –ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å —Ç–µ–≥–æ–≤ –∫—Ä–∏—Ç–∏—á–Ω–∞: **–µ—Å–ª–∏ —Ç—ã –º–µ–Ω—è–µ—à—å –Ω–æ–º–µ—Ä —Ç–µ–≥–∞ —É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—è**, –ø–æ–ª—É—á–∞—Ç–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.
- –ï—Å–ª–∏ —Ç—ã —É–¥–∞–ª—è–µ—à—å –ø–æ–ª–µ ‚Äî –ª—É—á—à–µ –Ω–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ —Ç–µ–≥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

### Protocol buffers: —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

https://developers.google.com/protocol-buffers/docs/encoding

**‚úÖ –°–∫–∞–ª—è—Ä–Ω—ã–µ —Ç–∏–ø—ã protobuf3**

| –¢–∏–ø          | –†–∞–∑–º–µ—Ä          | –û–ø–∏—Å–∞–Ω–∏–µ         |
| ------------ | --------------- | ---------------- |
| `float`/`double`      | 32 –±–∏—Ç/64 –±–∏—Ç   | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `float32`/`float64`. –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä. |
| `fixed32`/`fixed64`   | 32 –±–∏—Ç/64 –±–∏—Ç   | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `uint32`/`uint64`. –ë–µ–∑–∑–Ω–∞–∫–æ–≤–æ–µ —Ü–µ–ª–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, –µ—Å–ª–∏ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—à—å –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞.** |
| `sfixed32`/`sfixed64` | 32 –±–∏—Ç/64 –±–∏—Ç   | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `int32`/`int64`. –ó–Ω–∞–∫–æ–≤–æ–µ —Ü–µ–ª–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω, –µ—Å–ª–∏ —á–∞—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—ë—à—å –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞.** |
| `int32`/`int64`       | varint/varint   | –¶–µ–ª–æ–µ —Å–æ –∑–Ω–∞–∫–æ–º. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª (0...127 = 1 –±–∞–π—Ç). –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ ‚Äî –¥–æ 10 –±–∞–π—Ç. |
| `uint32`/`uint64`   | varint/varint          | –¶–µ–ª–æ–µ –±–µ–∑ –∑–Ω–∞–∫–∞. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —á–∏—Å–µ–ª.   |
| `sint32`/`sint64`   | varint (ZigZag)/varint (ZigZag) | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, —á–µ–º `int32`/`int64`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ZigZag-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ.      |
| `bool `    | 1 –±–∞–π—Ç          | `true` –∏–ª–∏ `false`.            |
| `string`   | –¥–ª–∏–Ω–∞ + UTF-8   | –°—Ç—Ä–æ–∫–∞ –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8. –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –∫–∞–∫ –¥–ª–∏–Ω–∞ + –±–∞–π—Ç—ã. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Unicode.  |
| `bytes`    | –¥–ª–∏–Ω–∞ + `[]byte` | –°—ã—Ä—ã–µ –±–∞–π—Ç—ã. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.      |

**üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏**

**üìè Varint**

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `int32`, `int64`, `uint32`, `uint64`, `sint32`, `sint64`.

- **–ú–∞–ª–µ–Ω—å–∫–∏–µ —á–∏—Å–ª–∞ –∑–∞–Ω–∏–º–∞—é—Ç –º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞**

  - –ü—Ä–∏–º–µ—Ä: `0 ... 127` ‚Üí 1 –±–∞–π—Ç

- **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤** `int32`/`int64` ‚Üí –≤—Å–µ–≥–¥–∞ 5/10 –±–∞–π—Ç!

  - –ü–æ—ç—Ç–æ–º—É –¥–ª—è –Ω–∏—Ö –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sint32`/`sint64` + ZigZag

**‚ö° ZigZag (–≤ `sint32`/`sint64`)**

ZigZag-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞:

| –ó–Ω–∞—á–µ–Ω–∏–µ | ZigZag | Varint |
| -------- | ------ | ------ |
| 0        | 0      | 0x00   |
| -1       | 1      | 0x01   |
| 1        | 2      | 0x02   |
| -2       | 3      | 0x03   |


**üì¶ fixed vs varint**
- `fixed32` / `fixed64` **–≤—Å–µ–≥–¥–∞ 4 / 8 –±–∞–π—Ç**, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è.
- **–ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —á–∞—Å—Ç–æ –±–æ–ª—å—à–∏–µ**, –∏ —Ç—ã –Ω–µ —Ö–æ—á–µ—à—å —Ç—Ä–∞—Ç–∏—Ç—å –¥–æ 10 –±–∞–π—Ç –Ω–∞ varint.

#### –ú–æ–∏ –∏–∑—ã—Å–∫–∞–Ω–∏—è

`varint` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –ø–∞—Ä–æ–≤–æ–∑–∏–∫–∞ —Å –≤–∞–≥–æ–Ω—á–∏–∫–∞–º–∏, –ø—Ä–∏ —ç—Ç–æ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∏–¥–µ—Ç –≤–ø—Ä–∞–≤–æ, —Ç.–µ. –º—ã –∏–¥–µ–º —Å –∫–æ–Ω—Ü–∞ —Å–æ—Å—Ç–∞–≤–∞.

`–≤–∞–≥–æ–Ω*` -> ... `–≤–∞–≥–æ–Ω*` -> `–ø–∞—Ä–æ–≤–æ–∑`
*–Ω–∞–ª–∏—á–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —á–∏—Å–ª–∞

–ü—Ä–∏ —ç—Ç–æ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∞–≥–æ–Ω–∞ –ø–∞—Ä–æ–≤–æ–∑–∞ –∏ –≤–∞–≥–æ–Ω–æ–≤ —Å—Ö–æ–∂–∞: `[*][***_****]`, –≥–¥–µ –ø–µ—Ä–≤—ã–π –±–∏—Ç `[*]` ‚Äî –±–∏—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è (—É –≤–∞–≥–æ–Ω–æ–≤ –æ–Ω 1, –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–∞—Ä–æ–≤–æ–∑ –¥–∞–ª—å—à–µ)

–î–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –≤ `int64` (—Å—Ç–∞—Ä—à–∏–π –±–∏—Ç –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å –∏ —Ä–∞–≤–µ–Ω 1) –∏ –∑–∞–Ω–∏–º–∞–µ—Ç —ç—Ç–æ –≤—Å–µ 8 –±–∞–π—Ç `1******* ******** ... ****`.
–ù–∞–ø—Ä–∏–º–µ—Ä, -1: `00000000 00000000 ... 0001` -> –∏–Ω–≤–µ—Ä—Å -> `11111111 1111 ... 1110` -> +1 -> `11111111 11111111 ... 1111` (–≤—Å–µ 64 –±–∏—Ç–∞ = 1)
–î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–ª–∞—Ö, —Ä–∞–∑–º–µ—Ä–æ–º 64 –±–∏—Ç–∞, –≤ `varint` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ 10 –±–∞–π—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–õ–æ–≥–∏—á–µ—Å–∫–∏:**
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ 64 –±–∏—Ç–∞ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∞ –≤–∞–≥–æ–Ω–∞—Ö/–ø–∞—Ä–æ–≤–æ–∑–∏–∫–µ 7 –±–∏—Ç –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏, —Ç–æ–≥–¥–∞ $ceil(64/7)=10$:
`[1][***_****]` -> ... -> `[1][***_****]` -> `[0][***_****]`

–ü—Ä–∏ —ç—Ç–æ–º —Å–Ω–∞—á–∞–ª–∞ –∏–¥—É—Ç –º–ª–∞–¥—à–∏–µ –±–∏—Ç—ã, —á—Ç–æ–±—ã –±—ã–ª–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ä–∞–∑—É —Ä–∞—Å—á–∏—Ç—ã–≤–∞—Ç—å –∏ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ –º–µ—Ä–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –æ—Ç –≤–∞–≥–æ–Ω–∞ –∫ –≤–∞–≥–æ–Ω—É.

–ù–∞–ø—Ä–∏–º–µ—Ä:
**varint**: `[1]011_1001]` -> `[0][000_1010]`

–≠—Ç–æ —á–∏—Å–ª–æ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –¥–≤–æ–∏—á–Ω–æ–π –∑–∞–ø–∏—Å–∏ `00_0101 0011_1001` = **1 337**

—Å `varint`/(ZigZag) –ø–æ–∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ: –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ —Å—Ç–∞—Ä—Ç—É—é—Ç –æ—Ç –Ω—É–ª—è –≤–º–µ—Å—Ç–µ, –ø–æ—ç—Ç–æ–º—É –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –≥–æ—Ä–∞–∑–¥–∞ –º–µ–Ω—å—à–µ.
–î–ª—è –±–æ–ª—å—à–∏—Ö –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ `sfixed64`.

üìä –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–∞ -1 –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–∞—Ö Protocol Buffers

| –í –¥–µ—Å—è—Ç–∏—á–Ω–æ–π | `sfixed64`             | `int64` (`varint`)                                                 | `sint64` (`varint`, ZigZag)  | ZigZag |
| ------------ | ---------------------- | ------------------------------------------------------------------ | ---------------------------- | ------ |
| `-1`         | `1111...1111` (64 –±–∏—Ç) | `[1][111_1111]` ‚Üí ... ‚Üí `[1][111_1111][0][000_0001]` ‚Üí **10 –±–∞–π—Ç** | `[0][000_0001]` ‚Üí **1 –±–∞–π—Ç** | `1`    |

* –≤ `int64` –≤—Å–µ –≤–µ—Ä–Ω–æ! –∫–æ–Ω–µ—Ü —Ç–∞–∫–æ–π `[0][000_0001]` —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—É—á–∞–µ–º –∏–∑ 10 –±–∞–π—Ç 70 –±–∏—Ç –ø–æ–ª–æ–∑–Ω–æ–π, –∞ –Ω–∞–º –Ω–∞–¥–æ 64, —Ç.–µ. –≤ –ø–∞—Ä–æ–≤–æ–∑–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –º–ª–∞–¥—à–∏–π –±–∏—Ç

### Protocol buffers: repeated fields

–°–ª–∞–π—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ **repeated**:

```proto
message SearchResponse {
    repeated Result results = 1;
}
message Result {
    string url = 1;
    string title = 2;
    repeated string snippets = 3;
}
```

``` proto
...
Snippets    []string `protobuf:"bytes,3,rep,name=snippets,proto3" json:"snippets,omitempty"`
...
Results     []*Result `protobuf:"bytes,1,rep,name=results,proto3" json:"results,omitempty"`
```

### Protocol buffers: Enums

```proto
enum EyeColor {
    EYE_COLOR_UNSPECIFIED = 0;
    EYE_COLOR_GREEN = 1;
    EYE_COLOR_BLUE = 2;
}
message Person {
    string name = 1;
    EyeColor eye_color = 2;
}
```

```go
type EyeColor int32
const (
    EyeColor_UNSPECIFIED    EyeColor = 0  // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ "–Ω—É–ª–µ–≤–æ–µ" –∑–Ω–∞—á–µ–Ω–∏–µ
    EyeColor_EYE_GREEN      EyeColor = 1
    EyeColor_EYE_BLUE       EyeColor = 2
)
```

### Protocol buffers: –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

| –¢–∏–ø –ø–æ–ª—è   | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é     | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                               |
| ---------- | ------------------------- | --------------------------------------------------------- |
| `string`   | `""`                      | –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞                                             |
| `bool`     | `false`                   |                                                           |
| `int32`    | `0`                       | –¢–æ –∂–µ –¥–ª—è `int64`, `uint32`, `uint64`, `float`, `double`  |
| `bytes`    | `[]byte{}` (–ø—É—Å—Ç–æ–π —Å–ª–∞–π—Å) |                                                           |
| `enum`     | –ü–µ—Ä–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–Ω–æ–µ        | –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –Ω—É–ª—è                                  |
| `repeated` | –ü—É—Å—Ç–æ–π —Å–ª–∞–π—Å              | –ù–µ `nil`, –∞ –∏–º–µ–Ω–Ω–æ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ (–≤ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ) |
| `message`  | `nil` –≤ Go                | –¢–æ –µ—Å—Ç—å –ø–æ–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –µ—Å–ª–∏ —è–≤–Ω–æ –Ω–µ –∑–∞–¥–∞–Ω–æ             |

[–î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è](https://developers.google.com/protocol-buffers/docs/reference/go-generated#singular-message)


### Protocol buffers: oneof, map


`oneof` - —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –ø–æ–ª–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å **repeated**.


```proto
message Message {
    int32 id = 1;
    oneof auth {
        string mobile = 2;
        string email = 3;
        int32 userid = 4;
    }
}
```

`map` - –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤;
–∫–ª—é—á–∏ - —Å–∫–∞–ª—è—Ä—ã (–∫—Ä–æ–º–µ `float`/`double`);
–∑–Ω–∞—á–µ–Ω–∏—è - –ª—é–±—ã–µ —Ç–∏–ø—ã, –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å **repeated**.

```proto
message Result {
    string result = 1;
}
message SearchResponse {
    map<string, Result> results = 1;
}
```


### Protocol buffers: wire types


–í Protocol Buffers –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

- key ‚Äî –∫–æ–¥–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä –ø–æ–ª—è (tag) –∏ wire type,
- value ‚Äî —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –¥–∞–Ω–Ω—ã–µ.

**–í—Å–µ–≥–æ 6 wire types:**

| Wire Type | –ù–æ–º–µ—Ä (3 –±–∏—Ç–∞) | –û–ø–∏—Å–∞–Ω–∏–µ                              | –ö–∞–∫–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è                           |
| --------- | -------------- | ------------------------------------- | -------------------------------------------------------- |
| 0         | 0              | **Varint** (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª–∏–Ω–∞ int)     | int32, int64, uint32, uint64, sint32, sint64, bool, enum |
| 1         | 1              | **64-–±–∏—Ç–Ω–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ**           | fixed64, sfixed64, double                                |
| 2         | 2              | **Length-delimited** (–¥–ª–∏–Ω–∞ + –¥–∞–Ω–Ω—ã–µ) | string, bytes, embedded messages, packed repeated fields |
| 3         | 3              | **Start group** (—É—Å—Ç–∞—Ä–µ–≤—à–µ–µ)          | deprecated, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ proto3                     |
| 4         | 4              | **End group** (—É—Å—Ç–∞—Ä–µ–≤—à–µ–µ)            | deprecated, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ proto3                     |
| 5         | 5              | **32-–±–∏—Ç–Ω–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ**           | fixed32, sfixed32, float                                 |


**–î–µ—Ç–∞–ª–∏:**

- **Wire type 0** ‚Äî **varint**:

    –ß–∏—Å–ª–∞ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω–æ–π ‚Äî –ø–æ 7 –±–∏—Ç –Ω–∞ –±–∞–π—Ç + 1 –±–∏—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –∏ enum.

- **Wire type 1** ‚Äî **64-–±–∏—Ç–Ω–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ**:

    –í—Å–µ–≥–¥–∞ 8 –±–∞–π—Ç –ø–æ–¥—Ä—è–¥. –î–ª—è `double`, `fixed64` –∏ `sfixed64`.

- **Wire type 2** ‚Äî **length-delimited**:
    
    –î–ª—è —Å—Ç—Ä–æ–∫, –±–∞–π—Ç–æ–≤—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤ –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.

- **Wire types 3 –∏ 4** ‚Äî –≥—Ä—É–ø–ø—ã:
    
    –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ proto3.

- **Wire type 5** ‚Äî 32-–±–∏—Ç–Ω–æ–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ:
    
    –í—Å–µ–≥–¥–∞ 4 –±–∞–π—Ç–∞ –ø–æ–¥—Ä—è–¥. –î–ª—è `float`, `fixed64` –∏ `sfixed64`.

![alt text](image-1.png)

### Protocol buffers: encoding format

```proto
message Person {
    required string user_name = 1;
    optional int64 favorite_number = 2;
    repeated string interests = 3;
}
```
![alt text](image-3.png)


## –ì–¥–µ `required` –∏ `optional`?

**‚úÖ `required` –≤ proto3**
`required` **–ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª—ë–Ω** –≤ `proto3`.
–≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Å—Ö–µ–º: —Ç–µ–ø–µ—Ä—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º.

‚ùå `required` ‚Äî –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ `proto3`.


**‚úÖ` optional` –≤ proto3**
–í —Ä–∞–Ω–Ω–∏—Ö –≤–µ—Ä—Å–∏—è—Ö proto3 –≤—Å–µ –ø–æ–ª—è –±—ã–ª–∏ "optional by default", –Ω–æ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–∑–Ω–∞—Ç—å, –∑–∞–¥–∞–Ω–æ –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–Ω–æ.
–ü–æ–∑–∂–µ (–Ω–∞—á–∏–Ω–∞—è —Å protobuf 3.15, –¥–µ–∫–∞–±—Ä—å 2020) –≤ proto3 –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `optional`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É –±–ª–∏–∂–µ –∫ proto2.

| –°–∏–Ω—Ç–∞–∫—Å–∏—Å    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ proto3 | –ú–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å, –∑–∞–¥–∞–Ω–æ –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ? |
| ------------ | ------------------ | --------------------------------- |
| `required`   | ‚ùå –∑–∞–ø—Ä–µ—â—ë–Ω         | ‚Äî                                |
| `optional`   | ‚úÖ (—Å 3.15+)        | ‚úÖ –¥–∞, —Å `optional`             |
| –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –≤—Å–µ –ø–æ–ª—è optional  | ‚ùå –Ω–µ—Ç, —Ñ–ª–∞–≥–æ–≤ –Ω–µ—Ç                |

## Protocol buffers: go_package

simplepb - –±–æ–ª–µ–µ —è–≤–Ω–æ

```proto
syntax = "proto3";

package example.simple;

option go_package = "./;simplepb";

message SimpleMessage {
    int32 id = 1;
    bool is_simple = 2;
    string name = 3;
    repeated int32 sample_list = 4;
}
```

```go
// Code generated by protoc-gen-go. DO NOT EDIT.
// source: simple/simple.proto
package simplepb
import proto "github.com/golang/protobuf/proto"
import fmt "fmt"
import math "math"
```

## Protocol buffers: Well Known Types

https://developers.google.com/protocol-buffers/docs/reference/google.protobuf

```proto
syntax = "proto3";
import "google/protobuf/timestamp.proto";
import "google/protobuf/duration.proto";

message MyMessage {
    google.protobuf.Timestamp last_online = 1;
    google.protobuf.Duration session_length = 2;
}
```

## Protocol buffers: –ø—Ä—è–º–∞—è/–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

![alt text](image-4.png)

- –Ω–µ –º–µ–Ω—è–π—Ç–µ —Ç–µ–≥–∏
- —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è
- –ø—Ä–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ–ª—è—Ö –∏—Å–ø–æ–ª—å—É—é—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ø–æ–ª—è –º–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å, –Ω–æ –Ω–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥ / —Å–¥–µ–ª–∞—Ç—å –ø–æ–ª–µ `reserved`

[–ü–æ–¥—Ä–æ–±–Ω–µ–µ](https://developers.google.com/protocol-buffers/docs/proto#updating)

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π:**

```proto
message MyMessage {
    int32 id = 1;
    string fist_name = 2; // + –¥–æ–±–∞–≤–∏–º
}
```

- **—Å—Ç–∞—Ä—ã–π –∫–æ–¥ –±—É–¥–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ**
- **–Ω–æ–≤—ã–π –∫–æ–¥ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ "—Å—Ç–∞—Ä—ã—Ö" –¥–∞–Ω–Ω—ã—Ö**

**–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–µ–Ω–∏–µ –ø–æ–ª–µ–π:**

```proto
message MyMessage {
    int32 id = 1;
    //string fist_name = 2; —É–¥–∞–ª–∏–º
    string person_first_name = 2; // –¥–æ–±–∞–≤–∏–º
}
```

- –±–∏–Ω–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ **–∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Ç–µ–≥**

## Protocol buffers: reserved


```proto
message Foo {
    reserved 2, 15, 9 to 11;
    reserved "foo", "bar";
}
```

- –º–æ–∂–Ω–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–≥–∏ –∏ –ø–æ–ª—è
- —Å–º–µ—à–∏–≤–∞—Ç—å –Ω–µ–ª—å–∑—è
- —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º —Ç–µ–≥–∏ —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏—Ö –Ω–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ (runtime errors)
- —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–∞–≥–æ–≤
**–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–π—Ç–µ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏ !**



## Protocol buffers: –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

- –Ω–µ –º–æ–∂–µ–º –æ—Ç–ª–∏—á–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ –æ—Ç –ø—É—Å—Ç–æ–≥–æ
- —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å —Ç–∑ –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã

```go
func (m *Course) GetTitle() string {
    if m != nil {
        return m.Title
    }
    return ""
}
```


## Protocol buffers: style guide

[–ü–æ–¥—Ä–æ–±–Ω–µ–µ](https://protobuf.dev/programming-guides/style/)

- —Å—Ç—Ä–æ–∫–∞ 80, –æ—Ç—Å—Ç—É–ø 2
- —Ñ–∞–π–ª—ã **lower_snake_case.proto**
- —Å–æ–æ–±—â–µ–Ω–∏—è `CamelCase`, –ø–æ–ª—è - `underscore_separated_names`
- `CAPITALS_WITH_UNDERSCORES` –¥–ª—è **enums**

```proto
message SongServerRequest {
    required string song_name = 1;
}

enum Foo {
    FOO_UNSPECIFIED = 0;
    FOO_FIRST_VALUE = 1;
    FOO_SECOND_VALUE = 2;
}
```


## –ß—Ç–æ —Ç–∞–∫–æ–µ gRPC

### –ü—Ä–µ–∂–¥–µ, —á–µ–º –Ω–∞—á–∞—Ç—å

1) –û–±–Ω–æ–≤–ª—è–µ–º protoc
https://github.com/protocolbuffers/protobuf/releases
2) –û–±–Ω–æ–≤–ª—è–µ–º protoc-gen-go –∏ protoc-gen-go-grpc
```
    go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
    go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

### RPC - Remote Procedure Call

**RPC**:
- —Å–µ—Ç–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç –∫–æ–¥–∞
- –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∫–∞–∫ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏–π (Interface Denition Language)
- —Ç—É–ª–∑—ã –¥–ª—è –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

**g**:
https://github.com/grpc/grpc/blob/master/doc/g_stands_for.md

- –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –±—ã—Å—Ç—Ä—ã—Ö API
- –î–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Protocol Buffers, –≥–¥–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏, –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
- –í –∫–∞—á–µ—Å—Ç–≤–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP2

### –û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –≤ gRPC

```proto
syntax = "proto3";

package search;
option go_package = "./;searchpb";

service Google {
    // Search returns a Google search result for the query.
    rpc Search(Request) returns (Result) {}
}

message Request {
    string query = 1;
}

message Result {
    string title = 1;
    string url = 2;
    string snippet = 3;
}
```


### –¢–∏–ø—ã gRPC API

![alt text](image-5.png)

### –ö–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC

```sh
protoc search.proto --go_out=. --go-grpc_out=.
```

```go
package searchpb;

type GoogleClient interface {
    // Search returns a Google search result for the query.
    Search(ctx context.Context, in *Request, opts ...grpc.CallOption) (*Result, error)
}

type GoogleServer interface {
    // Search returns a Google search result for the query.
    Search(context.Context, *Request) (*Result, error)
}

type Request struct {
    Query string `protobuf:"bytes,1,opt,name=query" json:"query,omitempty"`
}
type Result struct {
    Title string `protobuf:"bytes,1,opt,name=title" json:"title,omitempty"`
    Url string `protobuf:"bytes,2,opt,name=url" json:"url,omitempty"`
    Snippet string `protobuf:"bytes,3,opt,name=snippet" json:"snippet,omitempty"`
}
```

### –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å gRPC


![alt text](image-6.png)


### gRPC: –≥–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

- –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
- –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä
- –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ / API

- Apcera/Kurma: container OS
- Bazil: distributed le system
- CoreOS/Etcd: distributed consistent key-value store
- Google Cloud Bigtable: sparse table storage
- Monetas/Bitmessage: transaction platform
- Pachyderm: containerized data analytics
- YouTube/Vitess: storage platform for scaling MySQL


## gRPC vs REST

![alt text](image-7.png)

## HTTP/2 vs HTTP

https://imagekit.io/demo/http2-vs-http1
https://developers.google.com/web/fundamentals/performance/http2/

### HTTP/2 vs HTTP: header compression

![alt text](image-8.png)

### HTTP/2 vs HTTP: multiplexing

![alt text](image-9.png)

### HTTP/2 vs HTTP: server push

![alt text](image-10.png)

- –±–∏–Ω–∞—Ä–Ω—ã–π –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ
- –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –æ–¥–Ω–æ–º—É TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é
- —Å–∂–∞—Ç–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –º–µ—Ç–æ–¥–æ–º HPACK
- Server Push ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
- –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ (https://habr.com/ru/post/452020/)

https://medium.com/@factoryhr/http-2-the-difference-between-http-1-1-benefits-and-how-to-use-it-38094fa0e95b

### –ü—Ä–∏–º–µ—Ä—ã

https://github.com/OtusGolang/webinars_practical_part/tree/master/27-grpc


### gRPC: Errors

- https://grpc.io/docs/guides/error/
- https://grpc.io/docs/guides/error/#protocol-errors
- https://godoc.org/google.golang.org/grpc/codes
- https://godoc.org/google.golang.org/grpc/status
- https://jbrandhorst.com/post/grpc-errors/
- http://avi.im/grpc-errors/

```go
// Server
func (*server) SquareRoot(ctx context.Context, req *calculatorpb.SquareRootRequest) (*calculatorpb.SquareRootResponse, error) {
    number := req.GetNumber()
    if number < 0 {
        return nil, status.Errorf(codes.InvalidArgument, "received a negative number: %v", number)
    }
    return &calculatorpb.SquareRootResponse{
        NumberRoot: math.Sqrt(float64(number)),
    }, nil
}
```


```go
// Client
res, err := c.SquareRoot(
    context.Background()
    &calculatorpb.SquareRootRequest{Number: n},
)

if err != nil {
    respErr, ok := status.FromError(err)
    if ok {
        // actual error from gRPC (user error)
        fmt.Printf("Error message from server: %v\n", respErr.Message())
        fmt.Println(respErr.Code())
        if respErr.Code() == codes.InvalidArgument {
            fmt.Println("We probably sent a negative number!")
            return
        }
    } else {
        return
    }
}
```

### gRPC: Security (SSL/TLS)

- https://bbengfort.github.io/programmer/2017/03/03/secure-grpc.html
- https://medium.com/@gustavoh/building-microservices-in-go-and-python-using-grpc-and-tls-ssl-authentication-cfcee7c2b052

### gRPC: tools

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- https://github.com/bufbuild/buf

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- https://github.com/ktr0731/evans
- https://github.com/fullstorydev/grpcurl
- https://github.com/uw-labs/bloomrpc


### gRPC: transcoding

https://github.com/grpc-ecosystem/grpc-gateway