# –ü–∞–∫–µ—Ç `unsafe`

–ü–∞–∫–µ—Ç `unsafe` –≤ Go –¥–∞—ë—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ —Å–∫—Ä—ã—Ç—ã –≤ —è–∑—ã–∫–µ.

–ï–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è:

- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä
- –ü–æ–ª—É—á–µ–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –ø–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤ –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

–ù–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `unsafe` –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –µ—Å–ª–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Go.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ `unsafe`

1. `unsafe.Sizeof()`

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ —Ç–∏–ø–∞ **–≤ –±–∞–π—Ç–∞—Ö**.

    ```go
    package main

    import (
        "fmt"
        "unsafe"
    )

    func main() {
        var x int64
        fmt.Println(unsafe.Sizeof(x)) // 8 –±–∞–π—Ç

        var y struct {
            a int8
            b int64
            c int8
        }
        fmt.Println(unsafe.Sizeof(y)) // 24 –±–∞–π—Ç–∞ (–∏–∑-–∑–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è)
    }
    ```
2. `unsafe.Alignof()`

   –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **—Ç—Ä–µ–±—É–µ–º–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ** –¥–ª—è —Ç–∏–ø–∞ (–æ–±—ã—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ä–∞–∑–º–µ—Ä–æ–º —Å–∞–º–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–≥–æ —Ç–∏–ø–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ).

   ```go
    package main

    import (
        "fmt"
        "unsafe"
    )

    func main() {
        fmt.Println(unsafe.Alignof(int8(0)))    // 1
        fmt.Println(unsafe.Alignof(int64(0)))   // 8
        fmt.Println(unsafe.Alignof(float64(0))) // 8

        type Example struct {
            a int8  // 1 –±–∞–π—Ç
            b int64 // 8 –±–∞–π—Ç (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—Ä–æ–≤–Ω–µ–Ω –ø–æ 8)
            c int8  // 1 –±–∞–π—Ç
        }
        fmt.Println(unsafe.Alignof(Example{})) // 8 (–ø–æ —Å–∞–º–æ–º—É –±–æ–ª—å—à–æ–º—É —Ç–∏–ø—É)
    }
   ```

3. `unsafe.Offsetof()`

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Å–º–µ—â–µ–Ω–∏–µ** –ø–æ–ª—è –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–≤ –±–∞–π—Ç–∞—Ö –æ—Ç –Ω–∞—á–∞–ª–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã).

    ```go
    package main

    import (
        "fmt"
        "unsafe"
    )

    type Example struct {
        a int8  // 0-–π –±–∞–π—Ç
        b int64 // 8-–π –±–∞–π—Ç (–∏–∑-–∑–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è)
        c int8  // 16-–π –±–∞–π—Ç
    }

    func main() {
        fmt.Println(unsafe.Offsetof(Example{}.a)) // 0
        fmt.Println(unsafe.Offsetof(Example{}.b)) // 8
        fmt.Println(unsafe.Offsetof(Example{}.c)) // 16
    }
    ```
4. 
    `unsafe.Pointer` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ª—é–±–æ–º—É —Ç–∏–ø—É.

    üìå –ü—Ä–∏–º–µ—Ä: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ `*int` –≤ `*float64`:

    ```go
    package main

    import (
        "fmt"
        "unsafe"
    )

    func main() {
        var i int = 42
        ptr := unsafe.Pointer(&i)   // –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ *int ‚Üí unsafe.Pointer
        fptr := (*float64)(ptr)     // –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ unsafe.Pointer ‚Üí *float64

        fmt.Println(*fptr)          // –ß–∏—Ç–∞–µ–º –ø–∞–º—è—Ç—å –∫–∞–∫ float64 (–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è!)
    }
    ```

5. `uintptr`

    `uintptr` ‚Äî —ç—Ç–æ —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–æ–≥ —É–∫–∞–∑–∞—Ç–µ–ª—è. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏ —Å –∞–¥—Ä–µ—Å–∞–º–∏.

    üìå **–ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∏ —Å–¥–≤–∏–≥ –Ω–∞ 8 –±–∞–π—Ç:**

    ```go
    package main

    import (
        "fmt"
        "unsafe"
    )

    func main() {
        var arr = [2]int{42, 99}
        ptr := unsafe.Pointer(&arr[0]) // –ü–æ–ª—É—á–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ arr[0]
        ptr = unsafe.Pointer(uintptr(ptr) + unsafe.Sizeof(arr[0])) // –°–º–µ—â–∞–µ–º—Å—è –Ω–∞ 8 –±–∞–π—Ç (int64)

        fmt.Println(*(*int)(ptr))       // –ß–∏—Ç–∞–µ–º arr[1] (99)
    }
    ```


‚ùó –ö–æ–≥–¥–∞ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unsafe?

- ‚úî –î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ø–∞–º—è—Ç—å—é
- ‚úî –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å C-–∫–æ–¥–æ–º —á–µ—Ä–µ–∑ cgo)
- ‚úî –î–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö

‚ùå –ö–æ–≥–¥–∞ –ù–ï —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unsafe?
- ‚ùå –í –æ–±—ã—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö (–º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ)
- ‚ùå –ö–æ–≥–¥–∞ –µ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, reflect)
- ‚ùå –ï—Å–ª–∏ —Ç—ã –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–Ω–∏–º–∞–µ—à—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–º—è—Ç—å